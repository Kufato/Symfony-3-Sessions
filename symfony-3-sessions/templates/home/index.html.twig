{% extends 'base.html.twig' %}

{% block title %}Home{% endblock %}

{% block content %}
    <div style="
        display:flex;
        flex-direction:column;
        justify-content:center;
        align-items:center;
        min-height:60vh;
        gap:1.5rem;
        text-align:center;
        max-width:800px;
        margin:0 auto;
    ">

        {% if app.user %}
            <h2>
                Welcome
                <span class="rainbow-text">{{ app.user.username }}</span>
                ðŸ‘‹
            </h2>

            {% if is_granted('ROLE_ADMIN') %}
                <a href="{{ path('e02_admin') }}" style="
                    background:#6f42c1;
                    color:#fff;
                    padding:0.75rem 2rem;
                    border-radius:0.75rem;
                    text-decoration:none;
                    font-size:1.1rem;
                    transition:0.2s;
                " onmouseover="this.style.background='#59339d'"
                onmouseout="this.style.background='#6f42c1'">
                    Admin Panel
                </a>
            {% endif %}

            <form method="post" action="{{ path('e01_logout') }}">
                <button type="submit" style="
                    background:#dc3545;
                    color:#fff;
                    border:none;
                    padding:0.6rem 1.8rem;
                    border-radius:0.6rem;
                    font-size:1rem;
                    cursor:pointer;
                ">
                    Logout
                </button>
            </form>

            <a href="{{ path('e03_new') }}" style="
                background:#17a2b8;
                color:#fff;
                padding:0.6rem 1.8rem;
                border-radius:0.6rem;
                text-decoration:none;
                font-size:1rem;
                transition:0.2s;
            ">
                Create new post
            </a>

            <h3 style="margin-top:2rem; font-size:1.5rem;">Recent Posts</h3>

            {% if posts is not empty %}
                <ul style="list-style:none; padding:0; width:100%;">
                    {% for post in posts %}
                        <li style="
                            background:#f8f9fa;
                            margin-bottom:1rem;
                            padding:1rem;
                            border-radius:0.5rem;
                            text-align:left;
                        ">
                            <a href="{{ path('e03_show', {'id': post.id}) }}" style="
                                font-size:1.2rem;
                                font-weight:bold;
                                color:#007bff;
                                text-decoration:none;
                            ">
                                {{ post.title }}
                            </a>
                            <p style="margin:0.25rem 0; color:#555;">
                                by {{ post.author.username }} on {{ post.createdAt|date('d/m/Y H:i') }}
                            </p>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No posts yet.</p>
            {% endif %}

        {% else %}
            <h2>
                Welcome
                <span class="rainbow-text">
                    {{ anonymous.name }}
                </span>
                ðŸ‘‹
            </h2>

            <p style="font-size:0.9rem; color:#555;">
                Last request was {{ anonymous.seconds_since_last_request }} seconds ago
            </p>

            <p style="font-size:1rem; font-weight:bold;">
                Session expires in
                <span id="session-timer" style="color:#dc3545;">
                    {{ anonymous.seconds_remaining }}
                </span>
                seconds
            </p>

            <div style="display:flex; gap:1rem;">
                <a href="{{ path('e01_registration') }}" style="
                    background:#28a745;
                    color:#fff;
                    padding:0.6rem 1.6rem;
                    border-radius:0.6rem;
                    text-decoration:none;
                ">
                    Register
                </a>

                <a href="{{ path('e01_login') }}" style="
                    background:#007bff;
                    color:#fff;
                    padding:0.6rem 1.6rem;
                    border-radius:0.6rem;
                    text-decoration:none;
                ">
                    Login
                </a>
            </div>
        {% endif %}

    </div>

    {% if not app.user %}
        <script>
            let remaining = {{ anonymous.seconds_remaining }};
            const timerEl = document.getElementById('session-timer');

            if (timerEl) {
                const interval = setInterval(() => {
                    remaining--;
                    timerEl.textContent = remaining;

                    if (remaining <= 0) {
                        clearInterval(interval);
                        location.reload();
                    }
                }, 1000);
            }
        </script>
    {% endif %}
{% endblock %}